{% extends "base.html" %}
{% block content %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{{ url_for('list_firearms') }}">Firearms</a></li>
    <li class="breadcrumb-item active">{{ firearm.make }} {{ firearm.model }}</li>
  </ol>
</nav>

<div class="row mb-4">
    <!-- Firearm Specs -->
    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-dark text-white">Rifle Specifications</div>
            <div class="card-body">
                <h3>{{ firearm.make }} {{ firearm.model }}</h3>
                <hr>
                <p><strong>Caliber:</strong> {{ firearm.caliber }}</p>
                <p><strong>Barrel:</strong> {{ firearm.barrel_length }}" ({{ firearm.twist_rate }} twist)</p>
                <p><strong>Notes:</strong> {{ firearm.notes or 'None' }}</p>
            </div>
        </div>
    </div>
    
    <!-- Summary Stats -->
    <div class="col-md-8">
        <div class="row g-3">
            <div class="col-sm-4">
                <div class="card bg-primary text-white text-center p-3">
                    <h6>Best Group</h6>
                    {% if summary.best_moa == summary.best_moa %}
                    <h4>{{ summary.best_moa }} <small>MOA</small></h4>
                    {% else %}
                    <h4><small>N/A</small></h4>
                    {% endif %}
                </div>
            </div>
            <div class="col-sm-4">
                <div class="card bg-success text-white text-center p-3">
                    <h6>Avg. Velocity</h6>
                    <h4>{{ summary.avg_fps }} <small>FPS</small></h4>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="card bg-info text-white text-center p-3">
                    <h6>Logged Shots</h6>
                    <h4>{{ summary.total_shots }}</h4>
                </div>
            </div>
        </div>

        {% if chart_json %}
        <div class="card shadow-sm mt-3">
            <div id="firearmChart" style="height: 400px;"></div>
        </div>
        {% endif %}
    </div>
</div>

<div class="card shadow-sm pb-0">
    <div class="card-header">Test Session History</div>
    <table class="table table-striped mb-0">
        <thead>
            <tr>
                <th>Date</th>
                <th>Location</th>
                <th>Conditions</th>
                <th>Best Group</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for s in sessions %}
            <tr>
                <td>{{ s.test_date.strftime('%Y-%m-%d') }}</td>
                <td>{{ s.location }}</td>
                <td>{{ s.temperature_f }}Â°F | {{ s.humidity_percent }}%</td>
                <td>
                    {% if s.results %}
                        {{ s.results|map(attribute='group_size_moa')|reject('none')|min if s.results else 'N/A' }} MOA
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td><a href="/session/{{s.session_id}}" class="btn btn-sm btn-outline-primary">View</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    {% if chart_json %}
    var graph = {{ chart_json | safe }};
    Plotly.newPlot('firearmChart', graph.data, graph.layout, {responsive: true});
    {% endif %}
</script>
{% endblock %}